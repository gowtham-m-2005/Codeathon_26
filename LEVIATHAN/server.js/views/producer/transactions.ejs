<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Producer Transactions</title>
    <style>
        :root{--bg:#071229;--card:#0b1622;--muted:#9aa4b2;--accent:#06b6d4;--success:#10b981;--warn:#f59e0b}
        html,body{height:100%;}
        body{font-family:Inter,Segoe UI,Roboto,Arial; background:linear-gradient(180deg,#041021 0%,#071229 100%); color:#e6eef6; margin:0; padding:20px}
        .container{max-width:1400px;margin:0 auto}
        h1{margin:0 0 8px 0; font-size:24px}
        .subtitle{color:var(--muted); margin-bottom:20px; font-size:14px}
        .card{background:var(--card); padding:20px; border-radius:10px; box-shadow:0 8px 30px rgba(2,6,23,0.6); border:1px solid rgba(255,255,255,0.03); margin-bottom:20px}
        table{width:100%; border-collapse:collapse}
        th{text-align:left; padding:12px 10px; color:var(--muted); font-size:13px; border-bottom:2px solid rgba(255,255,255,0.08); font-weight:600}
        td{padding:12px 10px; border-bottom:1px solid rgba(255,255,255,0.03)}
        .status-badge{display:inline-block; padding:4px 10px; border-radius:6px; font-size:11px; font-weight:600}
        .status-delivering{background:rgba(245,158,11,0.2); color:var(--warn)}
        .status-completed{background:rgba(16,185,129,0.2); color:var(--success)}
        .status-requested{background:rgba(6,182,212,0.2); color:var(--accent)}
        .cost{font-weight:700; color:var(--success)}
        .no-value{color:var(--muted); font-style:italic}
    </style>
</head>
<body>
    <%- include('../partials/navbar') %>

    <div class="container">
        <h1>Producer: <%= producer.producer_name %></h1>
        <p class="subtitle">Transaction History with Cost Details</p>

        <div class="card">
            <% if (transactions && transactions.length > 0) { %>
                <table>
                    <thead>
                        <tr>
                            <th>Transaction ID</th>
                            <th>Container</th>
                            <th>Package ID</th>
                            <th>Type</th>
                            <th>Sections</th>
                            <th>Cost/Section</th>
                            <th>Distance (km)</th>
                            <th>Est. Delivery</th>
                            <th>Actual Delivery</th>
                            <th>Status</th>
                            <th>Total Cost</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% transactions.forEach(tx => { %>
                            <tr>
                                <td><%= tx.transaction_id %></td>
                                <td><%= tx.container_code || 'N/A' %></td>
                                <td><%= tx.package_id %></td>
                                <td><%= tx.transaction_type %></td>
                                <td><%= tx.sections_used || 0 %></td>
                                <td>₹<%= tx.cost_per_section ? parseFloat(tx.cost_per_section).toFixed(2) : '0.00' %></td>
                                <td><%= tx.distance_km ? parseFloat(tx.distance_km).toFixed(2) : '—' %></td>
                                <td>
                                    <% if (tx.estimated_delivery_time) { %>
                                        <%= new Date(tx.estimated_delivery_time).toLocaleString() %>
                                    <% } else { %>
                                        —
                                    <% } %>
                                </td>
                                <td>
                                    <% if (tx.actual_delivery_time) { %>
                                        <%= new Date(tx.actual_delivery_time).toLocaleString() %>
                                    <% } else { %>
                                        —
                                    <% } %>
                                </td>
                                <td>
                                    <span class="status-badge status-<%= tx.transaction_status.toLowerCase() %>">
                                        <%= tx.transaction_status %>
                                    </span>
                                </td>
                                <td>
                                    <% if (tx.transaction_status === 'COMPLETED' && tx.total_cost) { %>
                                        <span class="cost">₹<%= parseFloat(tx.total_cost).toFixed(2) %></span>
                                    <% } else { %>
                                        <span class="no-value">—</span>
                                    <% } %>
                                </td>
                            </tr>
                        <% }) %>
                    </tbody>
                </table>

                <div style="margin-top:20px; padding:16px; background:rgba(16,185,129,0.1); border-radius:8px; border-left:4px solid var(--success)">
                    <strong>Total Completed Revenue:</strong>
                    <span class="cost" style="font-size:20px; margin-left:12px">
                        ₹<%= transactions.filter(t => t.transaction_status === 'COMPLETED').reduce((sum, t) => sum + (parseFloat(t.total_cost) || 0), 0).toFixed(2) %>
                    </span>
                </div>
            <% } else { %>
                <div style="text-align:center; padding:40px; color:var(--muted)">
                    <p>No transactions found for this producer.</p>
                </div>
            <% } %>
        </div>
    </div>

    <%- include('../partials/footer') %>
</body>
</html>
